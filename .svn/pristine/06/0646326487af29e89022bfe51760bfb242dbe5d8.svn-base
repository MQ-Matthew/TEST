<p style="text-align: center;font-size: 24px;">{$flow_type['name']}申请单</p>
<p style="text-align: center;font-size: 18px;">支出凭单</p>
<!--新增模式-->                                    
<if condition="$on_edit eq add">
     <div class="form-group">
        <label class="col-sm-2 control-label" for="name">流程名称：</label>
        <div class="col-sm-9">
            <input class="form-control" type="text" id="name" name="name" value="{$vo.name}" check="require" msg="流程名称">
            <!-- <p class="text-warning">*（此栏须详细填写盖章的文件资料名称）</p> -->
        </div>
     </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.0.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.0.id}" id="udf_field_{$data.0.id}" value="{$vo.cid|get_dept_name=###}"  msg="请填写部门" readonly>
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.1.name}</label>
        <div class="col-sm-8">
                <input  class="form-control input-date" type="text" name="udf_field_{$data.1.id}" id="udf_field_{$data.1.id}" value="{:date('Y-m-d')}" readonly>       
        </div>
    </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.2.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.2.id}" name="udf_field_{$data.2.id}" check="require" msg="请选择摘要及用途" onchange="setVal()">
                <option value=''  >请选择</option>;
                <option value='停车费'  >停车费</option>;
                <option value='外出工作餐费'  >外出工作餐费</option>;
                <option value='出租车费'  >出租车费</option>;
                <option value='快递费'  >快递费</option>;
                <option value='其他'  >其他</option>;
                </select>
        </div>        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.3.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.3.id}" name="udf_field_{$data.3.id}"   check="require" msg="请选择经费来源" onchange="getVal()">
                    <!-- <option value=''>请选择</option>
                    <option value='基本经费'  >基本经费</option>
                    <option value='项目经费'  >项目经费</option>
                    <option value='课题经费'  >课题经费</option>
                    <option value='专项经费'  >专项经费</option>
                    <option value='总站经费'  >总站经费</option>
                    <option value='其他'  >其他</option> -->
                </select>
                <!-- <p class="text-warning">*（证明\说明\合同\协议\由中心主任审批）</p> -->
        </div>
        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.4.name}</label>
        <div class="col-sm-8">
                <select class="form-control" name="udf_field_{$data.4.id}" id="udf_field_{$data.4.id}"   check="require" msg="请选择经费来源" onchange="getKeti()">
                    <!-- <option value=''>请选择</option> -->
                    
                </select>
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.5.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.5.id}" id="udf_field_{$data.5.id}" value="{$data.5.val}" onblur="changenum();" check="number" msg="请输入金额，必须为数字！">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.6.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.6.id}" id="udf_field_{$data.6.id}" value="{$data.6.val}" readonly>       
        </div>
    </div>

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.9.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.9.id}" id="udf_field_{$data.9.id}" value="{$data.9.val}" onblur="changerealnum();"  readonly="true">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.10.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.10.id}" id="udf_field_{$data.10.id}" value="{$data.10.val}" readonly>       
        </div>
    </div>
    <!-- <div class="form-group">
        <label class="col-sm-2 control-label">{$data.5.name}</label>
        <div class="col-sm-9">
                <textarea class="form-control" name="udf_field_{$data.3.id}" rows="3" >{$data.5.val}</textarea> 
        </div>
    </div> -->

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.7.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.7.id}" id="udf_field_{$data.7.id}" value="{$data.7.val}" check="number" msg="请输入附单据数，必须为数字！">
        </div>
    </div>
    <div class="form-group ">
        <label class="col-sm-2 control-label">{$data.8.name}</label>
        <div class="col-sm-9">
                <input class="form-control" type="text" name="udf_field_{$data.8.id}" id="udf_field_{$data.8.id}" value="{$data.8.val}" >       
        </div>
    </div>

    
   
<!--编辑模式-->
<elseif condition="$on_edit eq edit"/>
    <div class="form-group">
        <label class="col-sm-2 control-label" for="name">流程名称：</label>
        <div class="col-sm-9">
            <input class="form-control" type="text" id="name" name="name" value="{$vo.name}" check="require" msg="流程名称">
            <!-- <p class="text-warning">*（此栏须详细填写盖章的文件资料名称）</p> -->
        </div>
     </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.0.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.0.id}" id="udf_field_{$data.0.id}" value="{$data.0.val}" readonly msg="请填写部门">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.1.name}</label>
        <div class="col-sm-8">
                <input  class="form-control input-date" type="text" name="udf_field_{$data.1.id}" id="udf_field_{$data.1.id}" value="{$data.1.val}" readonly>       
        </div>
    </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.2.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.2.id}" name="udf_field_{$data.2.id}" check="require" msg="请选择摘要及用途" onchange="setVal()">
                

                <option value='停车费' <if condition="$data['2']['val'] eq '停车费'">selected</if>>停车费</option>
                <option value='外出工作餐费' <if condition="$data['2']['val'] eq '外出工作餐费'">selected</if>>外出工作餐费</option>
                <option value='出租车费' <if condition="$data['2']['val'] eq '出租车费'">selected</if>>出租车费</option>
                <option value='快递费' <if condition="$data['2']['val'] eq '快递费'">selected</if>>快递费</option>
                <option value='其他' <if condition="$data['2']['val'] eq '其他'">selected</if>>其他</option>
                </select>
        </div>        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.3.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.3.id}" name="udf_field_{$data.3.id}"   check="require" msg="请选择经费来源" onchange="getVal()">
                    <option value='基本经费' <if condition="$data['3']['val'] eq '基本经费'">selected</if>>基本经费</option>
                    <option value='项目经费' <if condition="$data['3']['val'] eq '项目经费'">selected</if>>项目经费</option>
                    <option value='课题经费' <if condition="$data['3']['val'] eq '课题经费'">selected</if>>课题经费</option>
                    <option value='专项经费' <if condition="$data['3']['val'] eq '专项经费'">selected</if>>专项经费</option>
                    <option value='总站经费' <if condition="$data['3']['val'] eq '总站经费'">selected</if>>总站经费</option>
                </select>
        </div>
        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.4.name}</label>
        <div class="col-sm-8">
                <select class="form-control" name="udf_field_{$data.4.id}" id="udf_field_{$data.4.id}"   check="require" msg="请选择经费来源" onchange="getKeti()">
                    <!-- <option value=''>请选择</option> -->
                    <option value='{$data.4.val}'  >{$data.4.val}</option>
                </select>
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.5.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.5.id}" id="udf_field_{$data.5.id}" value="{$data.5.val}" onblur="changenum();" check="number" msg="请输入金额，必须为数字！">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.6.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.6.id}" id="udf_field_{$data.6.id}" value="{$data.6.val}" readonly>       
        </div>
    </div>

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.9.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.9.id}" id="udf_field_{$data.9.id}" value="{$data.9.val}" onblur="changerealnum();" check="number" readonly="true">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.10.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.10.id}" id="udf_field_{$data.10.id}" value="{$data.10.val}" readonly>       
        </div>
    </div>
    <!-- <div class="form-group">
        <label class="col-sm-2 control-label">{$data.5.name}</label>
        <div class="col-sm-9">
                <textarea class="form-control" name="udf_field_{$data.3.id}" rows="3" >{$data.5.val}</textarea> 
        </div>
    </div> -->

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.7.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.7.id}" id="udf_field_{$data.7.id}" value="{$data.7.val}" check="number" msg="请输入附单据数，必须为数字！">
        </div>
    </div>
    <div class="form-group ">
        <label class="col-sm-2 control-label">{$data.8.name}</label>
        <div class="col-sm-9">
                <input class="form-control" type="text" name="udf_field_{$data.8.id}" id="udf_field_{$data.8.id}" value="{$data.8.val}" >       
        </div>
    </div>
    
<!--印章管理员在执行的时候，需要填写实际用章次数-->
<elseif condition="$to_confirm.step eq 31"/>
    <input type="hidden" id="confirm" name="confirm" value="{$vo.confirm}">
    <input type="hidden" id="consult" name="consult" value="{$vo.consult}">
    <div class="form-group">
        <label class="col-sm-2 control-label" for="name">流程名称：</label>
        <div class="col-sm-9">
            <input class="form-control" type="text" id="name" name="name" value="{$vo.name}" readonly="true" check="require" msg="流程名称">
            <!-- <p class="text-warning">*（此栏须详细填写盖章的文件资料名称）</p> -->
        </div>
     </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.0.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.0.id}" id="udf_field_{$data.0.id}" readonly="true" value="{$data.0.val}"  msg="请填写部门">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.1.name}</label>
        <div class="col-sm-8">
                <input  class="form-control input-date" type="text" name="udf_field_{$data.1.id}" id="udf_field_{$data.1.id}" value="{$data.1.val}" readonly="true" >       
        </div>
    </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.2.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.2.id}" name="udf_field_{$data.2.id}" check="require" msg="请选择摘要及用途" readonly="true" onchange="setVal()">
                <option value='{$data.2.val}'  >{$data.2.val}</option>;
                <!-- <option value='停车费'  >停车费</option>;
                <option value='外出工作餐费'  >外出工作餐费</option>;
                <option value='出租车费'  >出租车费</option>;
                <option value='快递费'  >快递费</option>;
                <option value='其他'  >其他</option>; -->
                </select>
        </div>        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.3.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.3.id}" name="udf_field_{$data.3.id}"   check="require" msg="请选择经费来源" readonly="true" onchange="getVal()">
                    <option value='{$data.3.val}'>{$data.3.val}</option>
                    
                </select>
                
        </div>
        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.4.name}</label>
        <div class="col-sm-8">
                <select class="form-control" name="udf_field_{$data.4.id}" id="udf_field_{$data.4.id}" readonly="true"  check="require" msg="请选择经费来源" onchange="getKeti()">
                    <option value='{$data.4.val}'>{$data.4.val}</option>
                    
                </select>
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.5.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.5.id}" id="udf_field_{$data.5.id}" value="{$data.5.val}" readonly="true" onblur="changenum();" check="number" msg="请输入金额，必须为数字！">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.6.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.6.id}" id="udf_field_{$data.6.id}" value="{$data.6.val}" readonly="true">       
        </div>
    </div>

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.9.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.9.id}" id="udf_field_{$data.9.id}" value="{$data.9.val}" onchange="changerealnum();"  check="number" >
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.10.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.10.id}" id="udf_field_{$data.10.id}" value="{$data.10.val}" readonly="true">       
        </div>
    </div>
    

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.7.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.7.id}" id="udf_field_{$data.7.id}" value="{$data.7.val}" readonly="true" check="number" msg="请输入附单据数，必须为数字！">
        </div>
    </div>
    
    
    <div class="form-group col-sm-12">
        <label class="col-sm-2 control-label">{$data.8.name}</label>
        <div class="col-sm-8">
            <input class="form-control" type="text" id="udf_field_{$data.8.id}" name="udf_field_{$data.8.id}" value="{$data.8.val}" readonly="true" >
            
        </div>
     </div>



<!--阅读模式-->
<else />
    <div class="form-group">
        <label class="col-sm-2 control-label" for="name">流程名称：</label>
        <div class="col-sm-9">
            <input class="form-control" type="text" id="name" name="name" value="{$vo.name}" readonly="true" check="require" msg="流程名称">
            
        </div>
     </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.0.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.0.id}" id="udf_field_{$data.0.id}" readonly="true" value="{$data.0.val}"  msg="请填写部门">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.1.name}</label>
        <div class="col-sm-8">
                <input  class="form-control input-date" type="text" name="udf_field_{$data.1.id}" id="udf_field_{$data.1.id}" value="{$data.1.val}" readonly="true" >       
        </div>
    </div>
     <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.2.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.2.id}" name="udf_field_{$data.2.id}" check="require" msg="请选择摘要及用途" readonly="true" onchange="setVal()">
                <option value='{$data.2.val}'  >{$data.2.val}</option>;
                
                </select>
        </div>        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.3.name}<font color="#FF0000">*</font></label>
        <div class="col-sm-8">
                <select class="form-control" id="udf_field_{$data.3.id}" name="udf_field_{$data.3.id}"   check="require" msg="请选择经费来源" readonly="true" onchange="getVal()">
                    <option value='{$data.3.val}'>{$data.3.val}</option>
                    
                </select>
                
        </div>
        
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.4.name}</label>
        <div class="col-sm-8">
                <select class="form-control" name="udf_field_{$data.4.id}" id="udf_field_{$data.4.id}" readonly="true"  check="require" msg="请选择经费来源" onchange="getKeti()">
                    <option value='{$data.4.val}'>{$data.4.val}</option>
                    
                </select>
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.5.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.5.id}" id="udf_field_{$data.5.id}" value="{$data.5.val}" readonly="true" onblur="changenum();" check="number" msg="请输入金额，必须为数字！">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.6.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.6.id}" id="udf_field_{$data.6.id}" value="{$data.6.val}" readonly="true">       
        </div>
    </div>

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.9.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.9.id}" id="udf_field_{$data.9.id}" value="{$data.9.val}" onblur="changerealnum();" check="number" readonly="true">
        </div>
    </div>
    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.10.name}</label>
        <div class="col-sm-8">
                <input class="form-control" type="text" name="udf_field_{$data.10.id}" id="udf_field_{$data.10.id}" value="{$data.10.val}" readonly>       
        </div>
    </div>
    

    <div class="form-group col-sm-6">
        <label class="col-sm-4 control-label">{$data.7.name}<font color="#FF0000">*</font></label> 
        <div class="col-sm-8">
            <input class="form-control" type="text" name="udf_field_{$data.7.id}" id="udf_field_{$data.7.id}" value="{$data.7.val}" readonly="true" check="number" msg="请输入附单据数，必须为数字！">
        </div>
    </div>
    
    <div class="form-group col-sm-12">
        <label class="col-sm-2 control-label">{$data.8.name}</label>
        <div class="col-sm-8">
            <input class="form-control" type="text" id="udf_field_{$data.8.id}" name="udf_field_{$data.8.id}" value="{$data.8.val}" readonly="true" >
            
        </div>
     </div>

</if>

<script type="text/javascript" src="__INS__/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="__INS__/js/plugins/plupload/plupload.full.min.js"></script>
<script type="text/javascript">
    var step = '{$vo.step}';//草稿是10，退回是19，审批是20，执行是30，完成是40,100是参阅
    var department_head_user_name = '{:get_department_head_user_name()}';
    var on_edit = '{$on_edit}';
    var refer_flow_log_id = '{$to_refer.id}';//如果这个值是大于0的话，表示是合同人员参阅这个模式
    var current_flow_log_step = '{$to_confirm.step}';//flow_log当前用户执行的step值是多少
   
    $(function(){
        //get_department_list();
        //init_data();
        //
        if(refer_flow_log_id > 0 ||  current_flow_log_step == 31)
        {
            $('#view_file').remove();
            $('#zhixing').remove();
            $('#approve').remove();
            $('.hidden-print .pull-right').append('<a onclick="zhixing();" class="btn btn-sm btn-primary">保存并提交</a>');//添加一个保存按钮
            //$('#view_file').remove();
            
            // if(!$('#udf_field_341').attr("value")){
            //     $('#zhixing').remove();
            //     //alert('ok');
            // }
        }
        
        
    });

    function zhixing(){
        var yuanjine = $("#udf_field_{$data.5.id}").val();//审批过的金额        
        var shijine = $("#udf_field_{$data.9.id}").val(); //实际金额
        if(!isNaN(yuanjine) && shijine != ''){
            if(parseInt(yuanjine) >= parseInt(shijine)){
                changenums();
                save();
                approve();
            }else{
               ui_error('实际金额不能大于审批原金额！');                 
            }
        }else{
            ui_error('实际金额必须是数字！');
        }
        
    }

    function changerealnum(){
        var yuanjine = $("#udf_field_{$data.5.id}").val();//审批过的金额        
        var shijine = $("#udf_field_{$data.9.id}").val(); //实际金额
        if(!isNaN(yuanjine) && shijine != ''){
            if(parseInt(yuanjine) >= parseInt(shijine)){
                changenums();
                
            }else{
               ui_error('实际金额不能大于审批原金额！');                 
            }
        }else{
            ui_error('实际金额必须是数字！');
        }
        
    }

    function changenums(){
        // var m = Number(prompt("金额："));
        var m = $("#udf_field_{$data.9.id}").val();
        // var xz = $("#udf_field_{$data.4.id}");
        // m = parseFloat($("#udf_field_356").val());
        m = floatMul(m,100);
        m = Math.floor(m);
        // alert(m);
        
        m += "";
        if(!isNaN(m)){
            var length = m.length;
            var unit = new Array("仟", "佰", "拾", "", "仟", "佰", "拾", "", "角", "分");
            var result = "";
            for (var i = 0; i < length; i++) {
                if (i == 2) {
                    result = "元" + result;
                } else if (i == 6) {
                    result = "万" + result;
                }
                if (m.charAt(length - i - 1) == 0) {
                    if (i != 0 && i != 1) {
                        if (result.charAt(0) != '零' && result.charAt(0) != '元' && result.charAt(0) != '万') {
                            result = "零" + result;
                        }
                    }
                    continue;
                }
                result = toDx(m.charAt(length - i - 1)) + unit[unit.length - i - 1] + result;
            }
            result += result.charAt(result.length - 1) == '元' ? "整" : "";
            // $("#udf_field_357").attr(result);
            $("#udf_field_{$data.10.id}").attr("value",result);
        }else{
            $("#udf_field_{$data.10.id}").attr("value",'');
        }
        

    }
    
    
    function changenum(){
        // var m = Number(prompt("金额："));
        m = parseFloat($("#udf_field_{$data.5.id}").val());
        m = floatMul(m,100);
        m = Math.floor(m);
        // alert(m);
        
        m += "";
        if(!isNaN(m)){
            var length = m.length;
            var unit = new Array("仟", "佰", "拾", "", "仟", "佰", "拾", "", "角", "分");
            var result = "";
            for (var i = 0; i < length; i++) {
                if (i == 2) {
                    result = "元" + result;
                } else if (i == 6) {
                    result = "万" + result;
                }
                if (m.charAt(length - i - 1) == 0) {
                    if (i != 0 && i != 1) {
                        if (result.charAt(0) != '零' && result.charAt(0) != '元' && result.charAt(0) != '万') {
                            result = "零" + result;
                        }
                    }
                    continue;
                }
                result = toDx(m.charAt(length - i - 1)) + unit[unit.length - i - 1] + result;
            }
            result += result.charAt(result.length - 1) == '元' ? "整" : "";
            // $("#udf_field_357").attr(result);
            $("#udf_field_357").attr("value",result);
        }else{
            $("#udf_field_357").attr("value",'');
        }
        
        // alert(m);

    }

    function toDx(n) {
        switch (n) {
            case "0":
                return "零";
            case "1":
                return "壹";
            case "2":
                return "贰";
            case "3":
                return "叁";
            case "4":
                return "肆";
            case "5":
                return "伍";
            case "6":
                return "陆";
            case "7":
                return "柒";
            case "8":
                return "捌";
            case "9":
                return "玖";
        }
    }

    function floatMul(arg1,arg2)   {     
        var m=0,s1=arg1.toString(),s2=arg2.toString();     
        try{m+=s1.split(".")[1].length}catch(e){}     
        try{m+=s2.split(".")[1].length}catch(e){}     
        return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m);     
    }

    
    
    function send_massage()
    {
        //winopen("__ROOT__/index.php?m=&c=popup&a=sendmessage", 560, 370);
        winopen("{:U('popup/sendmessage',array('info'=>$vo))}",560, 370); 
    }

    //功能：初始化数据
    function init_data()
    {
        var temp, obj, i, html='', dis='';
        var digit = ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二', '十三', '十四', '十五'];

        if(!(on_edit == 'add' || on_edit == 'edit'))
            dis = 'disabled';
        
        
    }

    function setVal(){
        var yt = $("#udf_field_{$data.2.id}").val();
        var ly = $("#udf_field_{$data.3.id}");
        var xz = $("#udf_field_{$data.4.id}");
        var option = '';
        if(yt == '停车费'){
            $("option",ly).remove();
            $("option",xz).remove();
            option = "<option value='基本经费'>基本经费</option>";
            ly.append(option);
            xz.append(option);
        }else{
            $("option",ly).remove();
            $("option",xz).remove();
            option += "<option value=''>请选择</option>";
            option += "<option value='基本经费'  >基本经费</option>";
            option += "<option value='项目经费'  >项目经费</option>";
            option += "<option value='课题经费'  >课题经费</option>";
            option += "<option value='专项经费'  >专项经费</option>";
            option += "<option value='总站经费'  >总站经费</option>";
            option += "<option value='其他'  >其他</option>";
            ly.append(option);
        }
        
    }

    function getVal(){
            var ly = $("#udf_field_{$data.3.id}").val();
            var xz = $("#udf_field_{$data.4.id}");
            
            $("option",xz).remove(); //清空原有的选项，也可使用 ds_id.empty(); 
            var option = '';
            //xpgw.empty();
            if(ly=="基本经费"){

                option = "<option value='基本经费'>基本经费</option>";
                xz.append(option);
                var next_audit_name = '';
                save_data['next_audit_name'] = next_audit_name;
                
            }else if(ly=='项目经费'){
                $.ajax({
                type:'POST',
                data:'type='+ly,
                url:"{:U('Form/getform')}",
                cache:false,
                success: function(data){
                    if(data){
                        
                        xz.append(data);
                        var next_audit_name = '';
                        save_data['next_audit_name'] = next_audit_name;
                    }
                }
            });
            }else if(ly=='课题经费'){
                $.ajax({
                type:'POST',
                data:'type='+ly,
                url:"{:U('Form/getform')}",
                cache:false,
                success: function(data){
                    if(data){
                        xz.append(data);
                    }
                }
            });
                
            }else if(ly=='专项经费'){
                $.ajax({
                type:'POST',
                data:'type='+ly,
                url:"{:U('Form/getform')}",
                cache:false,
                success: function(data){
                    if(data){
                        // $("#receive_userid").html(data);
                        xz.append(data);
                        var next_audit_name = '';
                        save_data['next_audit_name'] = next_audit_name;
                        // window.console.log(data);
                        // alert(111);
                    }
                }
            });
            }else if(ly=='总站经费'){
                $.ajax({
                type:'POST',
                data:'type='+ly,
                url:"{:U('Form/getform')}",
                cache:false,
                success: function(data){
                    if(data){
                        // $("#receive_userid").html(data);
                        xz.append(data);
                        var next_audit_name = '';
                        save_data['next_audit_name'] = next_audit_name;
                    }
                }
            });
            
            
        }
    } 

    function getKeti(){
        var ly = $("#udf_field_{$data.3.id}").val();
        var xz = $("#udf_field_{$data.4.id}").val();
        if(ly=='课题经费'){
            $.ajax({
                type:'POST',
                data:'keti='+xz,
                url:"{:U('Form/getketi')}",
                cache:false,
                success: function(data){
                    if(data){
                        // alert(data);
                        var next_audit_name = data;
                        save_data['next_audit_name'] = next_audit_name;
                        // window.console.log(data);
                        // alert(111);
                    }
                }
            });
        }

    }
   
</script>