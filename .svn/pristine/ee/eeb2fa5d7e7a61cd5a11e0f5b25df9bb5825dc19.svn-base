<extend name="Layout/ins_page" />
<block name="content">
    <script type="text/javascript">
        var save_data = [];//全局保存save函数调用的时候，需要用到参数
    </script>
    {:W('PageHeader/simple',array('name'=>'领用资产 :  '.$info['name']))}
    <div class="operate panel panel-default">
        <div class="panel-body">
            <div class="pull-left">
                <a onclick="javascript:window.history.back(-1);" class="btn btn-sm btn-primary">返回</a>

            </div>
            <div class="pull-right">
                <a onclick="save();"  class="btn btn-sm btn-primary">领用</a>
            </div>
        </div>
    </div>

    <form method='post' id="form_data" name="form_data" enctype="multipart/form-data" class="well form-horizontal">

        <input type="hidden" name="id" value="{$info.id}">

        <div class="form-group">
            <label class="col-sm-2 control-label" for="type">领用人 :</label>
            <div class="col-sm-5">
                <select name="receive_deptid" id="receive_deptid" name="receive_deptid" class="form-control" check="require" msg="请选择领用所在部门">
                    <option value="">--请选择领用人部门--</option>
                    <volist name="depts" id="keshi">
                        <option value="{$keshi.id}">{$keshi.html}{$keshi.name}</option>
                    </volist>
                </select>
            </div>

            <div class="col-sm-4">
                <select name="receive_userid" id="receive_userid"  name="receive_userid" class="form-control" check="require" msg="请选择领用人">
                </select>
            </div>
        </div>


        <div class="form-group col-sm-6">
            <label class="col-sm-4 control-label" for="type">设备类型 :</label>
            <div class="col-sm-8">
                <input class="form-control" type="text" id="type"  value="{$info.type|get_assettype}" readonly>
                <input class="form-control" type="hidden" name="type"  value="{$info.type}" readonly>
            </div>
        </div>




        <div class="form-group col-sm-6">
            <label class="col-sm-6 control-label" for="islowvalue">是否低值易耗(设备属性):</label>
            <div class="col-sm-6">

                <input class="form-control" type="text" id="islowvalue" value="{$info.islowvalue|get_islowvalue}" readonly>
                <input class="form-control" type="hidden"  name="islowvalue"  value="{$info.islowvalue}">

            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label" for="name">设备名称：</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" id="name" name="name" value="{$info.name}" readonly>
            </div>
        </div>

        <div class="form-group  col-sm-6">
            <label class="col-sm-4 control-label" for="name">设备品牌：</label>
            <div class="col-sm-8">
                <input class="form-control" type="text" id="brand"  name="brand"  readonly value="{$info.brand}">
            </div>
        </div>

        <div class="form-group  col-sm-6">
            <label class="col-sm-4 control-label" for="name">房间号：</label>
            <div class="col-sm-8">
                <input class="form-control" type="text" id="receive_roomid" name="receive_roomid" value="" check="require" msg="请输入房间号">
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label" for="name">设备描述 :</label>


                <!--<div class="col-sm-9">
                    <p id="description" style="width:100%;min-height:100px;border: 1px solid #cccccc;overflow-y:scroll; overflow-x:hidden;" onchange="show();">
                    </p>
                    <input type="hidden" id="descriptions" name="description" value='{$info["description"]}'> &lt;!&ndash;这儿的隐藏域的值用的是''号&ndash;&gt;

                </div>
-->

                <div class="col-sm-9">
                    <textarea disabled="disabled" style="width:100%;min-height:220px;border: 1px solid #cccccc;overflow-y:scroll; overflow-x:hidden;resize:none;" >{$info["description"]}</textarea>
                </div>

        </div>

        <div class="form-group">
            <if condition="$info.islowvalue eq 2">

                <label class="col-sm-2 control-label" for="name">领用数量 :</label>

                <else/>

                <label class="col-sm-3 control-label" for="name" style="margin-left: 35px;">领用数量( 当前库存量：{$info.amount} ) :</label>

            </if>

            <if condition="$info.islowvalue eq 2">
                <div class="col-sm-9">
                    <input class="form-control" type="text" id="amount" name="amount" value="{$info.amount}" readonly>
                </div>
            <else/>
                <div class="col-sm-7">
                    <input type="hidden" id="asset_amount"  name="asset_amount" value="{$info.amount}">
                    <input class="form-control" type="text" id="amounts" name="amount" value="" onblur="show_mount();">
                </div>

            </if>

        </div>



        <div class="form-group">
            <label class="col-sm-2 control-label" for="name">备注:</label>
            <div class="col-sm-9">
                <input class="form-control" type="text" id="remarks" name="remarks">
            </div>
        </div>


        <br>

    </form>

</block>

<block name="js">

    <script type="text/javascript">

        function save() {
            sendForm("form_data","{:U('Asset/save_lingyong')}","{:U('Asset/index')}");
        }


        $(document).ready(function() {
            $pid = $("#id", parent.document).val();
            $("#pid").val($pid);
        });

    //获取所在部门的人员 ajax
        $("#receive_deptid").change(function(){
            $.ajax({
                type:'POST',
                data:'id='+$("#receive_deptid").val(),
                url:"{:U('Asset/get_user_name')}",
                cache:false,
                success: function(data){

                    if(data){
                        $("#receive_userid").html(data);
                    }
                }
            });
        });


        function show_mount(){
            var asset_mount=$("#asset_amount").val();
            var mount=$("#amounts").val();

            var re = /^[0-9]+.?[0-9]*$/; //判断字符串是否为数字 //判断正整数 /^[1-9]+[0-9]*]*$/

            if (!re.test(mount)) {
                ui_error("请输入为整数数字");
            }

           // alert(typeof(mount));return;

            if(parseInt(mount) > parseInt(asset_mount)){
                ui_error('当前领用的设备数量不能超过库存量，请重新输入领用的数量，谢谢！你最多可领用的数量是'+asset_mount);
            }
        }


    </script>

    <script type="text/javascript">
        document.onreadystatechange = function(){
            if(document.readyState == "complete"){
                //当页面加载状态为完全结束时进入
                var str = '';
                str = document.getElementById("descriptions").value;
                if(str !== null){
                    viewTableData(str);
                }
            }
        }

        function viewTableData(str){
            var data = str;
            var obj = eval('(' + data + ')');
            var html='';

            for(key in obj){

               html+= key+'&nbsp;:&nbsp;'+obj[key]+"<br>";
            }
           // alert(html);
            $("#description").html(html);
        }


    </script>



</block>